/*! lightLayer - v0.1.0 - 2014-08-25
* https://github.com/martinmethod/lightLayer
* Copyright (c) 2014 Martin Metodiev; Licensed MIT */

!function(a){a(function(){a("body").wrapInner('<div id="ll-general">')}),a.lightLayer=function(b){var c=a.lightLayer;return c.params=b,c.extended||a.extend(c,{extended:!0,initial:{target:{object:a("#popup")},options:{cache:!0,escape:!0,position:"middle",backgroundColor:"#000000",opacity:.3,transition:.1}},flags:{},storage:{},css:{transitionend:"transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",transitions:{"-webkit-transition":null,"-moz-transition":null,"-ms-transition":null,"-o-transition":null,transition:null}},define:{target:function(){return c.target={object:c.params&&c.params.hasOwnProperty("object")?c.params.object:c.initial.target.object,data:c.params&&c.params.hasOwnProperty("data")?c.params.data:{}},this},options:function(){c.options={};for(var a in c.initial.options)c.options[a]=c.params&&c.params.hasOwnProperty(a)?c.params[a]:c.initial.options[a];return this},events:function(){c.events={};for(var a=["onOpen","onClose","onChangeBackgroundColor","onChangeOpacity","onChangePosition","onChangeEscape","onChangeSettings"],b=0;b<a.length;b++)c.params&&c.params.hasOwnProperty(a[b])&&(c.events[a[b]]=c.params[a[b]]);return this}},layerMethods:{getPopupData:function(){var a=this.popup.data;return a},backgroundColor:function(a){!function(){"undefined"!==a&&c.set.check("backgroundColor",a)&&(c.layer.trigger("onChangeBackgroundColor",[{old_value:c.options.backgroundColor,new_value:a}]),c.options.backgroundColor=a,c.set.background())}()},opacity:function(a){!function(){"undefined"!==a&&c.set.check("opacity",a)&&(c.layer.trigger("onChangeOpacity",[{old_value:c.options.opacity,new_value:a}]),c.options.opacity=a,c.set.background())}()},position:function(b){switch(function(){"undefined"!==b&&c.set.check("position",b)&&(c.layer.trigger("onChangePosition",[{old_value:c.options.position,new_value:b}]),c.options.position=b,a("#ll-cell").removeAttr("style"),c.layer.popup.css("top",""),a(window).unbind("resize",c.set.thirdPosition))}(),c.layer.popup.is(":visible")||c.layer.popup.css("display","inline-block"),c.options.position){case"middle":a("#ll-cell").css("vertical-align","middle");break;case"third":c.set.thirdPosition(),a(window).bind("resize",c.set.thirdPosition),a("#ll-holder").css("margin-top","20px");break;case"top":a("#ll-cell").css("vertical-align","top")}return c.layer},escape:function(b){!function(){"undefined"!==b&&c.set.check("escape",b)&&(c.layer.trigger("onChangeEscape",[{old_value:c.options.escape,new_value:b}]),c.options.escape=b)}();var d=function(){return c.layer.popup.find(".x-button").length>0&&c.layer.popup.find(".x-button").remove(),c.layer.popup.find(".x-button").length>0?c.layer.popup.find(".x-button"):c.layer.popup.prepend(a('<a class="x-button" href="javascript:;"></a>')).find(".x-button")}();return c.options.escape?c.flags.escape||(d.bind("click",function(a){c.layer.exit(),a.stopPropagation()}),c.layer.bind("keydown",function(a){27===a.keyCode&&c.layer.exit()}).bind("click",function(a){c.layer.exit(),a.stopPropagation()}),c.flags.escape=!0):(d&&d.remove(),c.flags.escape&&(c.layer.unbind("keydown"),c.layer.unbind("click"),c.flags.escape=!1)),c.layer},change:function(b){if(function(){b="object"!=typeof b||a.isEmptyObject(b)?null:b}(),b){c.layer.trigger("onChangeSettings",[b]);for(var d in b)c.layer.hasOwnProperty(d)&&c.layer[d](b[d])}return this},exit:function(){var b=function(){a("body").removeClass("lightlayer"),a("#ll-general").removeAttr("style"),c.layer.popup.removeClass("active-popup").css({display:"none",opacity:"",top:""}),c.layer.trigger("onClose",[c.layer.popup]),c.storage[c.layer.popup.attr("id")].cached=c.layer.popup.clone(),c.layer.popup.removeClass("ll-pop"),c.layer.popup.find(".custom-close").unbind("click"),a(window).unbind("resize",c.set.thirdPosition),c.set.originLocation(c.storage[c.layer.popup.attr("id")].original),c.layer.remove(),a(document).scrollTop(c.flags.scrolled),delete c.layer,delete c.target,delete c.options,delete c.events,delete c.params,c.flags={}};"0"===c.options.transition||navigator.userAgent.match(/msie/i)||Object.hasOwnProperty.call(window,"ActiveXObject")&&!window.ActiveXObject?b():c.layer.bind(c.css.transitionend,function(){b()}),c.layer.css({opacity:0})}},popupMethods:{saveOriginLocation:function(a){return this.originLocation=c.get.originLocation(a),this},saveData:function(){return this.data=c.target.hasOwnProperty("data")?c.target.data:null,this},bindCustomClose:function(){return this.find(".custom-close").length>0&&this.find(".custom-close").bind("click",function(a){c.layer.exit(),a.stopPropagation()}),this},move:function(b){return c.layer.popup.addClass("ll-pop").appendTo(a("#ll-holder")),b.remove(),this},store:function(){return c.storage.hasOwnProperty(this.attr("id"))||(c.storage[this.attr("id")]={original:this}),this}},init:{layer:function(){a("body").addClass("lightlayer").append(a("<div>",{id:"lightlayer",tabindex:"1"}).css({display:"table"}).append(a("<div>",{id:"ll-cell"}).append(a("<div>",{id:"ll-holder"}))));for(var b in c.css.transitions)c.css.transitions[b]="opacity "+c.options.transition+"s ease-in, background-color 0.2s ease-in";return c.layer=a("#lightlayer").css(c.css.transitions),a.extend(c.layer,c.layerMethods),this},popup:function(){var b=c.get.object();b&&(c.layer.popup=a.extend(b.clone(),c.popupMethods),c.layer.popup.saveOriginLocation(b).saveData().bindCustomClose().move(b).store())}},prepare:{scrollTop:function(){return c.flags.scrolled=a(document).scrollTop(),this},document:function(){return a("#ll-general").css({width:"100%",position:"fixed",left:0,top:"-"+c.flags.scrolled+"px",minHeight:"100%"}),this},events:function(){for(var a in c.events)c.layer.bind(a,c.events[a]);return this}},set:{check:function(b,d){return a.extend(this.check,{escape:function(){return"boolean"==typeof d&&d!==c.options.escape?!0:!1},position:function(){return"top"===d||"third"===d||"middle"===d&&d!==c.options.position?!0:!1},backgroundColor:function(){return"string"==typeof d&&d!==c.options.backgroundColor?!0:!1},opacity:function(){return"number"==typeof d&&d>=0&&1>=d&&d!==c.options.opacity?!0:!1}}),this.check[b]()},background:function(){var a=JSON.parse(function(a){return"#"===a.charAt(0)&&(a=a.substr(1)),JSON.stringify({r:parseInt(a.charAt(0)+""+a.charAt(1),16),g:parseInt(a.charAt(2)+""+a.charAt(3),16),b:parseInt(a.charAt(4)+""+a.charAt(5),16)})}(c.options.backgroundColor));return c.layer.css("background-color","rgba("+a.r+", "+a.g+", "+a.b+", "+c.options.opacity+")"),c.layer},thirdPosition:function(){return c.layer?void c.layer.popup.css(c.layer.popup.height()<a(window).height()-40?{top:parseInt((a(window).height()-c.layer.popup.height())/3-20)}:{top:"auto"}):!1},originLocation:function(b){var c=b.originLocation;c.parent?a(c.parent).prepend(c.obj):a(c.prev).after(c.obj)}},get:{object:function(){var b=a.extend(a(c.target.object[0]),{idCheck:function(){return"undefined"==typeof this.attr("id")&&(c.flags.index=c.flags.hasOwnProperty("index")?c.flags.index+1:1,this.attr("id","popup_"+c.flags.index)),this}});return c.options.cache&&c.storage[b.idCheck().attr("id")]?c.storage[b.attr("id")].cached:0!==b.length?b:null},originLocation:function(b){var c={},d=a(b).prev();return c.obj=b,d.length?c.prev=d[0]:c.parent=a(b).parent()[0],c}},reveal:{popup:function(){return c.layer.trigger("onOpen",[c.layer.popup]),c.layer.popup.bind("click",function(a){a.stopPropagation()}).find("a").bind("click",function(a){a.stopPropagation()}),setTimeout(function(){a(document).scrollTop(0)},100),c.layer.popup.css("opacity",1).addClass("active-popup"),this},layer:function(){return setTimeout(function(){c.layer.css({opacity:1}).focus()},0),this}}}),c.layer||(c.define.target().options().events(),c.init.layer().popup(),c.prepare.scrollTop().document().events(),c.set.background().position().escape(),c.reveal.popup().layer()),c.layer},a.fn.lightLayer=function(b){var c;return this.each(function(d){0===d&&(b=a.extend({},{object:a(this)},b),c=a.lightLayer(b))}),c}}(jQuery);
//# sourceMappingURL=jquery.lightLayer.min.js.map